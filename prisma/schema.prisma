// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Member {
  MemberID Int @id @default(autoincrement())
  CitizenID String @unique
  Name String
  Address String
  PhoneNumber String
  Credit Int
  DateOfBirth DateTime
  Gender Int  
  Deleted Boolean @default(false)

  Employee Employee @relation(fields: [EmployeeID], references: [EmployeeID])
  EmployeeID Int

  BorrowInvoices BorrowInvoice[]
}

model Employee {
  EmployeeID Int @id @default(autoincrement())
  Name String
  Address String
  PhoneNumber String
  DateOfBirth DateTime
  Gender Int
  Email String
  CitizenID String

  Account Account?
  Member Member[]
  BorrowInvoices BorrowInvoice[]
  ChangeInvoices ChangeInvoice[]
}

model Account {
  AccountID Int @id @default(autoincrement())
  Username String @unique 
  Password String
  AccessLevel Int

  Owner Employee @relation(fields: [OwnerID], references: [EmployeeID])
  OwnerID Int @unique
}

model Book {
  ISBN13 String @unique @id
  Title String
  Author String
  PublishDate DateTime
  Deleted Boolean @default(false)

  BookDetails BookDetail[]
  BorrowDetails BorrowDetail[]
  ChangeDetails ChangeDetail[]
}

model BookDetail {
  Status String 
  Quantity Int

  Book Book @relation(fields: [ISBN13],references: [ISBN13])
  ISBN13 String

  @@id([Status,ISBN13])
  @@unique([Status,ISBN13])
}

model BorrowInvoice {
  BorrowInvoiceID Int @id @default(autoincrement())
  BorrowingDate DateTime

  Member Member[]
  Employee Employee[]

  BorrowDetails BorrowDetail[]
}

model BorrowDetail {
  Quantity Int
  
  Returned Int @default(0)
  Damaged Int @default(0)
  Lost Int @default(0)

  DueDate DateTime

  BorrowInvoice BorrowInvoice @relation(fields: [BorrowInvoiceID], references: [BorrowInvoiceID])
  BorrowInvoiceID Int 

  Book Book @relation(fields: [ISBN13], references: [ISBN13])
  ISBN13 String 

  HasReturned Boolean @default(false)

  @@id([BorrowInvoiceID,ISBN13]) 
}

model ChangeInvoice {
  ChangeInvoiceID Int @id @default(autoincrement())
  ChangeDate DateTime

  Employee Employee @relation(fields: [EmployeeID], references: [EmployeeID])
  EmployeeID Int

  ChangeDetail ChangeDetail[]
}

model ChangeDetail {
  Partner String
  Quantity Int
  ChangeType Int

  Book Book @relation(fields: [ISBN13], references: [ISBN13])
  ISBN13 String

  ChangeInvoice ChangeInvoice @relation(fields: [ChangeInvoiceID], references: [ChangeInvoiceID])
  ChangeInvoiceID Int
  
  @@id([ISBN13,ChangeInvoiceID])
}

